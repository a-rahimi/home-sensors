# MQTT consumer: Qingping air quality (qingping/{MAC}/up)
# Uses json_v2 to parse every element of sensorData; each element becomes one
# Influx point with fields co2_value, temperature_value, etc. (no array index
# in names). Timestamp for each point is that element's timestamp_value (Unix s).
[[inputs.mqtt_consumer]]
  servers = ["tcp://mosquitto:1883"]
  topics = ["qingping/+/up"]
  data_format = "json_v2"
  topic_tag = "topic"

  [[inputs.mqtt_consumer.json_v2]]
    measurement_name = "qingping"

    [[inputs.mqtt_consumer.json_v2.object]]
      path = "sensorData"
      optional = true
      timestamp_key = "timestamp_value"
      timestamp_format = "unix"
      timestamp_timezone = "UTC"
      excluded_keys = ["timestamp_value"]

# InfluxDB v2 output (token from env at runtime)
[[outputs.influxdb_v2]]
  urls = ["http://influxdb:8086"]
  token = "${INFLUXDB_TOKEN}"
  organization = "home-sensors"
  bucket = "sensors"
